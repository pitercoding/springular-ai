<mat-card class="chat-container">
  <div class="chat-header">
    <mat-toolbar>
        <span>Simple Chat</span>
    </mat-toolbar>
  </div>

  <div class="chat-history" #chatHistory>
    <div class="messages">

      @for (message of messages(); track $index) {
        <div class="message">
          <div class="message-bubble" [class.user]="!message.isBot">
            {{ message.message }}
          </div>
        </div>
      }

      @if (isLoading) {
        <div class="message">
          <div class="message-bubble">
            <span class="typing">...</span>
          </div>
        </div>
      }

    </div>
  </div>

  <div class="chat-input">
    <mat-form-field class="full-width">
      <mat-label>Ask anything</mat-label>
      <input matInput
            [ngModel]="userPrompt()"
            (ngModelChange)="userPrompt.set($event)"
            (keyup.enter)="sendMessage()"
            [maxlength]="MAX_LENGTH"
            placeholder="Type your message...">
      <mat-hint align="end">{{userPrompt().length}}/{{MAX_LENGTH}}</mat-hint>
      @if (validationError()) {
        <mat-error>{{validationError()}}</mat-error>
      }
      @if (userPrompt()) {
        <button matSuffix
                mat-icon-button
                aria-label="Send"
                (click)="sendMessage()"
                [disabled]="!canSend()">
          <mat-icon>send</mat-icon>
        </button>
     }
    </mat-form-field>
  </div>
</mat-card>
